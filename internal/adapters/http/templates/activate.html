{{ define "content" }}
<div class="card" style="max-width:440px;margin:3rem auto;">
    <div style="text-align:center;margin-bottom:2rem;">
        <div style="font-size:0.75rem;text-transform:uppercase;letter-spacing:2px;color:#6c757d;margin-bottom:0.5rem;">Workshop Jiu Jitsu</div>
        <h1 style="margin:0;font-weight:300;font-size:1.75rem;">Activate Your Account</h1>
    </div>
    {{ if .Error }}
    <div id="activateError" style="background:#fff3f3;color:#c00;padding:0.75rem;border-left:3px solid #c00;margin-bottom:1.5rem;font-size:0.85rem;">
        {{ .Error }}
    </div>
    {{ else }}
    <p style="color:var(--text-muted);font-size:0.9rem;margin-bottom:1.5rem;">Set your password to activate your account.</p>
    <div id="activateMsg" style="display:none;padding:0.75rem;margin-bottom:1rem;font-size:0.85rem;border-left:3px solid transparent;"></div>
    <form id="activateForm" onsubmit="return activateAccount(event)">
        <input type="hidden" id="activateToken" value="{{ .Token }}">
        <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" name="newPassword" required autocomplete="new-password" minlength="12" placeholder="Minimum 12 characters">
            <div style="font-size:0.75rem;color:var(--text-muted);margin-top:0.25rem;">Minimum 12 characters</div>
        </div>
        <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required autocomplete="new-password" minlength="12">
        </div>
        <button type="submit" id="activateBtn" style="width:100%;padding:0.85rem;">Activate Account</button>
    </form>
    <script>
    function activateAccount(e) {
        e.preventDefault();
        const pw = document.getElementById('newPassword').value;
        const confirm = document.getElementById('confirmPassword').value;
        const msg = document.getElementById('activateMsg');

        if (pw !== confirm) {
            msg.style.display = 'block';
            msg.style.background = '#fff3f3';
            msg.style.color = '#c00';
            msg.style.borderColor = '#c00';
            msg.textContent = 'Passwords do not match.';
            return false;
        }

        fetch('/api/activate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                Token: document.getElementById('activateToken').value,
                Password: pw
            })
        }).then(r => {
            if (!r.ok) return r.text().then(t => { throw new Error(t); });
            return r.json();
        }).then(data => {
            msg.style.display = 'block';
            msg.style.background = '#f0fff0';
            msg.style.color = '#060';
            msg.style.borderColor = '#060';
            msg.textContent = 'Account activated! You can now log in.';
            document.getElementById('activateForm').style.display = 'none';
            setTimeout(() => { window.location.href = '/login'; }, 2000);
        }).catch(err => {
            msg.style.display = 'block';
            msg.style.background = '#fff3f3';
            msg.style.color = '#c00';
            msg.style.borderColor = '#c00';
            msg.textContent = err.message;
        });
        return false;
    }
    </script>
    {{ end }}
</div>
{{ end }}
