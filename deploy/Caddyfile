# Replace YOUR_DOMAIN with your actual domain (e.g., app.workshopjiujitsu.co.nz)
# If you don't have a domain yet, use :80 instead of the domain line
# and Caddy will serve on HTTP only.
#
# With a domain, Caddy automatically provisions HTTPS via Let's Encrypt.

YOUR_DOMAIN {
	reverse_proxy localhost:8080

	encode gzip

	header {
		# HSTS — tell browsers to always use HTTPS (2 years, include subdomains)
		Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

		# Prevent MIME sniffing
		X-Content-Type-Options "nosniff"

		# Prevent framing (clickjacking)
		X-Frame-Options "DENY"

		# Control referrer leakage
		Referrer-Policy "strict-origin-when-cross-origin"

		# Disable browser features we don't use
		Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()"

		# Remove server identity
		-Server
		-X-Powered-By
	}

	# Limit request body size (10MB — prevents abuse)
	request_body {
		max_size 10MB
	}

	log {
		output file /var/log/caddy/workshop.log {
			roll_size 50MiB
			roll_keep 5
		}
		format json
	}
}
